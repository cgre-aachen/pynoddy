<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Marks Fault Uncertainty Study &mdash; pynoddy  documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pynoddy  documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="marks-fault-uncertainty-study">
<h1>Marks Fault Uncertainty Study<a class="headerlink" href="#marks-fault-uncertainty-study" title="Permalink to this headline">¶</a></h1>
<p>We will here use the methods described before for a fully automatted
uncertainty study of the two fault model. As a first step, we define
some basic settings and import required python packages:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># some basic inputs and settings</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="c"># adjust some settings for matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c"># print rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="c"># determine path of repository to set paths corretly below</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">r&#39;/Users/Florian/git/pynoddy/docs/notebooks/&#39;</span><span class="p">)</span><span class="c"># some basic module imports</span>
<span class="n">repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s">&#39;../..&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pynoddy</span>
<span class="c"># Change to sandbox directory to store results</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="s">&#39;sandbox&#39;</span><span class="p">))</span>

<span class="c"># Path to exmaple directory in this repository</span>
<span class="n">example_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span><span class="s">&#39;examples&#39;</span><span class="p">)</span>
<span class="c"># Compute noddy model for history file</span>
<span class="n">history</span> <span class="o">=</span> <span class="s">&#39;simple_two_faults.his&#39;</span>
<span class="n">history_ori</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">example_directory</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
<span class="n">output_name</span> <span class="o">=</span> <span class="s">&#39;noddy_out&#39;</span>
<span class="n">H1</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">history_ori</span><span class="p">)</span>
<span class="c"># Before we do anything else, let&#39;s actually define the cube size here to</span>
<span class="c"># adjust the resolution for all subsequent examples</span>
<span class="n">H1</span><span class="o">.</span><span class="n">change_cube_size</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
<span class="c"># compute model - note: not strictly required, here just to ensure changed cube size</span>
<span class="n">H1</span><span class="o">.</span><span class="n">swap_events</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span>
<span class="n">H1</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">output_name</span><span class="p">)</span>
</pre></div>
</div>
<p>As a next step, let&#8217;s load the output file and visualise the model in a
cross-section:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># and now let&#39;s visualise the model:</span>
<span class="n">NO</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>
<span class="n">NO</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Marks Fault Model&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_3_0.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_3_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;Fault1&#39;</span>
</pre></div>
</div>
<p>Let&#8217;s assume that we want to know the position of the fault
intersections, for example because we expect a certain mineralisation
process to happen at this point. Estimating the intersection of two
lines from a block model can be a tricky thing, but in this case, we can
simply estimate it as the point where, at a given line at depth, we swap
from two possible lithologies to three, and then back from three to two
again (not really a general approach, but working in this very specific
case). Implemented with a little bit of numpy:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">find_intersections</span><span class="p">(</span><span class="n">NO</span><span class="p">,</span> <span class="n">swapped</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find fault intersections assuming strictly horizontal layering</span>
<span class="sd">    NO: Noddy output, swapped: flag if fault history is swapped&quot;&quot;&quot;</span>
    <span class="n">last</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">)[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="n">NO</span><span class="o">.</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">,:,</span><span class="n">i</span><span class="p">]</span>
        <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">last</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="c"># determine switchpoint:</span>
            <span class="n">first_switch</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">second_switch</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">last_val</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">first_switch</span><span class="p">:</span>
                    <span class="c"># find first switch point</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">last_val</span><span class="p">:</span>
                        <span class="n">first_switch</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">first_id</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="n">last_val</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">first_switch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">second_switch</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">last_val</span><span class="p">:</span>
                        <span class="n">second_switch</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">second_id</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="n">last_val</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">first_switch</span> <span class="ow">and</span> <span class="n">second_switch</span><span class="p">:</span>
                    <span class="c"># find second switch point</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">last_val</span><span class="p">:</span>
                        <span class="n">third_id</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="k">break</span>
                <span class="n">last_val</span> <span class="o">=</span> <span class="n">val</span>
            <span class="c"># assign ids to models according to type of model</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">swapped</span><span class="p">:</span>
                <span class="n">first_intersect</span> <span class="o">=</span> <span class="p">((</span><span class="n">second_id</span> <span class="o">+</span> <span class="n">third_id</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_intersect</span> <span class="o">=</span> <span class="p">((</span><span class="n">first_id</span> <span class="o">+</span> <span class="n">second_id</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">last</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="n">NO</span><span class="o">.</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">,:,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c"># determine switchpoint:</span>
            <span class="n">first_switch</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">second_switch</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">last_val</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">first_switch</span><span class="p">:</span>
                    <span class="c"># find first switch point</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">last_val</span><span class="p">:</span>
                        <span class="n">first_switch</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">last_val</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="n">first_id</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">first_switch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">second_switch</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">last_val</span><span class="p">:</span>
                        <span class="n">second_switch</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">second_id</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="n">last_val</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">first_switch</span> <span class="ow">and</span> <span class="n">second_switch</span><span class="p">:</span>
                    <span class="c"># find second switch point</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">last_val</span><span class="p">:</span>
                        <span class="n">third_id</span> <span class="o">=</span> <span class="n">j</span>
<span class="c">#                         first_intersect = ((first_id + second_id)/2, i)</span>

                        <span class="k">break</span>
                <span class="n">last_val</span> <span class="o">=</span> <span class="n">val</span>

            <span class="c"># assign ids to models according to type of model</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">swapped</span><span class="p">:</span>
                <span class="n">second_intersect</span> <span class="o">=</span> <span class="p">((</span><span class="n">first_id</span> <span class="o">+</span> <span class="n">second_id</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">second_intersect</span> <span class="o">=</span> <span class="p">((</span><span class="n">second_id</span> <span class="o">+</span> <span class="n">third_id</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">unique_vals</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">first_intersect</span><span class="p">,</span> <span class="n">second_intersect</span><span class="p">)</span>

<span class="p">(</span><span class="n">first_intersect</span><span class="p">,</span> <span class="n">second_intersect</span><span class="p">)</span> <span class="o">=</span> <span class="n">find_intersections</span><span class="p">(</span><span class="n">NO</span><span class="p">,</span> <span class="n">swapped</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

&lt;ipython-input-123-3113d735a009&gt; in &lt;module&gt;()
     74     return (first_intersect, second_intersect)
     75
---&gt; 76 (first_intersect, second_intersect) = find_intersections(NO, swapped=True)


&lt;ipython-input-123-3113d735a009&gt; in find_intersections(NO, swapped)
     70                 second_intersect = ((first_id + second_id)/2, i-1)
     71             else:
---&gt; 72                 second_intersect = ((second_id + third_id)/2, i-1)
     73         last = unique_vals
     74     return (first_intersect, second_intersect)


UnboundLocalError: local variable &#39;third_id&#39; referenced before assignment
</pre></div>
</div>
<p>The above code is quite horrible, but at least it provides the fault
intersection points. Let&#8217;s check in a section plot:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">NO</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Marks Fault Model with intersections&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">first_intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;ko&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">second_intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">second_intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;ko&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">print</span> <span class="n">first_intersect</span><span class="p">,</span> <span class="n">second_intersect</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_7_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_7_1.png" />
<p>Even though the implementation is horrible, it does work... so let&#8217;s
have a look at the more interesting aspect: uncertainties!</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># let&#39;s try something else: find points where units change</span>
<span class="n">changes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="n">NO</span><span class="o">.</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">,:,:]))</span>
<span class="n">section</span> <span class="o">=</span> <span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="n">NO</span><span class="o">.</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">,:,:]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">)[</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="n">NO</span><span class="o">.</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">,:,</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">line</span> <span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">changes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">intersections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c"># Now determine intersections from lines:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">changes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">changes</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">changes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">changes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">intersections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">intersections</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span> <span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">25</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">NO</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Marks Fault Model with intersections&quot;</span><span class="p">,</span>
                <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c"># ax.plot(first_intersect[0], first_intersect[1], &#39;ko&#39;, markersize=10)</span>
<span class="c"># ax.plot(second_intersect[0], second_intersect[1], &#39;ko&#39;, markersize=10)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">changes</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x10f379e90&gt;
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_10_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_10_1.png" />
<p>Add a &#8220;nearest cell&#8221; search for a 3x3 subset (8 neighbours) with the
condition: fault intersection exists, when the cell itself plus three
neighbours show changes:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">change_intersects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">changes</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">changes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">changes</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">changes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">changes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">change_intersects</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">NO</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Marks Fault Model with intersections&quot;</span><span class="p">,</span>
                <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="c"># ax.plot(first_intersect[0], first_intersect[1], &#39;ko&#39;, markersize=10)</span>
<span class="c"># ax.plot(second_intersect[0], second_intersect[1], &#39;ko&#39;, markersize=10)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">NO</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Marks Fault Model with intersections&quot;</span><span class="p">,</span>
                <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">changes</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">change_intersects</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x113867210&gt;
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_13_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_13_1.png" />
<p>The last example also doesn&#8217;t seem like the best approach - something
else again: analyse a subset of the model, when</p>
<div class="section" id="evaluating-the-effect-of-uncertainties-in-fault-dip">
<h2>Evaluating the effect of uncertainties in fault dip<a class="headerlink" href="#evaluating-the-effect-of-uncertainties-in-fault-dip" title="Permalink to this headline">¶</a></h2>
<p>We would like to evaluate how uncertainties in (1) the timing of the
fault, and (2) the fault properties (dip, position) lead to
uncertainties in the exact position of the fault intersection points.</p>
<p>First, we look at uncertainties in the dip of the fault. We assign a
simple normal distribution with the mean as the prior dip
 and a defined standard deviation  for
the fault dips angles :</p>
<p></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Load starting model</span>
<span class="n">H1</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
<span class="n">H1</span><span class="o">.</span><span class="n">swap_events</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="c"># define file names for temporary files</span>
<span class="n">tmp_in</span> <span class="o">=</span> <span class="s">&#39;marks_fault_study_tmp.his&#39;</span>
<span class="n">tmp_out</span> <span class="o">=</span> <span class="s">&#39;marks_faults_out&#39;</span>
<span class="c"># Determine original dips (Fault1 is event 2, Fault2 is event 3)</span>
<span class="n">F1_dip_ori</span> <span class="o">=</span> <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span>
<span class="n">F2_dip_ori</span> <span class="o">=</span> <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span>
<span class="c"># set standard deviation for fault dips</span>
<span class="n">dip_stdev</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="c"># number of simulations</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c"># store all drawn values for postprocessing</span>
<span class="n">F1_all_dips</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">F2_all_dips</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_outputs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">F1_dip_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">*</span> <span class="n">dip_stdev</span>
    <span class="n">F2_dip_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">*</span> <span class="n">dip_stdev</span>
    <span class="n">F1_all_dips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F1_dip_change</span><span class="p">)</span>
    <span class="n">F2_all_dips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F2_dip_change</span><span class="p">)</span>
    <span class="c"># assign back to events</span>
    <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F1_dip_ori</span> <span class="o">+</span> <span class="n">F1_dip_change</span>
    <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F2_dip_ori</span> <span class="o">+</span> <span class="n">F2_dip_change</span>
    <span class="n">H1</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">)</span>
    <span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">,</span> <span class="n">tmp_out</span><span class="p">)</span>
    <span class="n">NO</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
    <span class="n">all_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NO</span><span class="p">)</span>
</pre></div>
</div>
<p>As a quick check, let&#8217;s look at some of the generated models:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">all_outputs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_18_0.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_18_0.png" />
<p>The next step is now to determine all fault intersections. As we
evaluate the intersections on a discretised version anyway, we can use
the same mesh to store the intersections in discretised locations and
produce probability plots:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># initiate intersection grid</span>
<span class="n">NO</span> <span class="o">=</span> <span class="n">all_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">intersections_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="n">NO</span><span class="o">.</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">,:,:]))</span>
<span class="n">failed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">NO</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_outputs</span><span class="p">):</span>
    <span class="c"># Note: the oversimplified intersection algorithm above fails for some</span>
    <span class="c"># cases - catch those cases and simply move on for now as a work-around.</span>
    <span class="c"># (The better way would, of course, be to check why...)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">first_intersect</span><span class="p">,</span> <span class="n">second_intersect</span><span class="p">)</span> <span class="o">=</span> <span class="n">find_intersections</span><span class="p">(</span><span class="n">NO</span><span class="p">,</span> <span class="n">swapped</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">continue</span>
    <span class="n">intersections_grid</span><span class="p">[</span><span class="n">first_intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">intersections_grid</span><span class="p">[</span><span class="n">second_intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">second_intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;The intersection determination failed for </span><span class="si">%d</span><span class="s"> out of </span><span class="si">%d</span><span class="s"> grids&quot;</span> \
      <span class="o">%</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">failed</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>The intersection determination failed for 2 out of 10 grids
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">first_intersect</span><span class="p">,</span> <span class="n">second_intersect</span><span class="p">)</span> <span class="o">=</span> <span class="n">find_intersections</span><span class="p">(</span><span class="n">all_outputs</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="k">print</span> <span class="n">failed</span>
<span class="n">all_outputs</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ 0.  0.  0.  1.  0.  0.  0.  0.  0.  1.]
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_21_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_21_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># overlay probability on one output</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">all_outputs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">intersections_grid</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
       <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x113aef3d0&gt;
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_22_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_22_1.png" />
</div>
<div class="section" id="considering-uncertainties-in-the-history">
<h2>Considering uncertainties in the history<a class="headerlink" href="#considering-uncertainties-in-the-history" title="Permalink to this headline">¶</a></h2>
<p>In addition to uncertainties about the exact dip of a structure, we
might be uncertain about the order of events in the history.
Specifically, in this case: the order of the two faults.</p>
<p>To consider this type of uncertainty, we include the possibility to swap
the order of the fault events with a defined probability:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># assign probability to swap fault order</span>
<span class="n">swap_prob</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># we use the same loop as before, but</span>
<span class="c"># include the possibility to swap the events:</span>
<span class="c"># Load starting model</span>
<span class="n">H1</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">history_ori</span><span class="p">)</span>
<span class="n">H1</span><span class="o">.</span><span class="n">change_cube_size</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
<span class="c"># define file names for temporary files</span>
<span class="n">tmp_in</span> <span class="o">=</span> <span class="s">&#39;marks_fault_study_tmp.his&#39;</span>
<span class="n">tmp_out</span> <span class="o">=</span> <span class="s">&#39;marks_faults_out&#39;</span>
<span class="c"># Determine original dips (Fault1 is event 2, Fault2 is event 3)</span>
<span class="n">F1_dip_ori</span> <span class="o">=</span> <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span>
<span class="n">F2_dip_ori</span> <span class="o">=</span> <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span>
<span class="c"># set standard deviation for fault dips</span>
<span class="n">dip_stdev</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="c"># number of simulations</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="c"># store all drawn values for postprocessing</span>
<span class="n">F1_all_dips</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">F2_all_dips</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_fault_states</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># 0: normal order, 1: swapped order</span>
<span class="n">all_outputs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">F1_dip_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">*</span> <span class="n">dip_stdev</span>
    <span class="n">F2_dip_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">*</span> <span class="n">dip_stdev</span>
    <span class="c"># swap?</span>
    <span class="n">swap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">swap_prob</span><span class="p">)</span>
    <span class="n">all_fault_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">swap</span><span class="p">)</span>
    <span class="n">F1_all_dips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F1_dip_change</span><span class="p">)</span>
    <span class="n">F2_all_dips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F2_dip_change</span><span class="p">)</span>
    <span class="c"># assign back to events</span>
    <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F1_dip_ori</span> <span class="o">+</span> <span class="n">F1_dip_change</span>
    <span class="n">H1</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F2_dip_ori</span> <span class="o">+</span> <span class="n">F2_dip_change</span>
    <span class="c"># swap</span>
    <span class="k">if</span> <span class="n">swap</span><span class="p">:</span>
        <span class="n">H1</span><span class="o">.</span><span class="n">swap_events</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">H1</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">swap</span><span class="p">:</span> <span class="c"># swap back to get model into original state</span>
        <span class="n">H1</span><span class="o">.</span><span class="n">swap_events</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">,</span> <span class="n">tmp_out</span><span class="p">)</span>
    <span class="n">NO</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
    <span class="n">all_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NO</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># initiate intersection grid</span>
<span class="n">NO</span> <span class="o">=</span> <span class="n">all_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">intersections_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">NO</span><span class="o">.</span><span class="n">block</span><span class="p">[</span><span class="n">NO</span><span class="o">.</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">,:,:]))</span>
<span class="n">failed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">NO</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_outputs</span><span class="p">):</span>
    <span class="c"># Note: the oversimplified intersection algorithm above fails for some</span>
    <span class="c"># cases - catch those cases and simply move on for now as a work-around.</span>
    <span class="c"># (The better way would, of course, be to check why...)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">first_intersect</span><span class="p">,</span> <span class="n">second_intersect</span><span class="p">)</span> <span class="o">=</span> <span class="n">find_intersections</span><span class="p">(</span><span class="n">NO</span><span class="p">,</span> <span class="n">swapped</span><span class="o">=</span><span class="n">all_fault_states</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">continue</span>
    <span class="n">intersections_grid</span><span class="p">[</span><span class="n">first_intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">intersections_grid</span><span class="p">[</span><span class="n">second_intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">second_intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;The intersection determination failed for </span><span class="si">%d</span><span class="s"> out of </span><span class="si">%d</span><span class="s"> grids&quot;</span> \
      <span class="o">%</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">failed</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

&lt;ipython-input-195-8289fab0334c&gt; in &lt;module&gt;()
      1 # initiate intersection grid
      2 NO = all_outputs[0]
----&gt; 3 intersections_grid = np.zeros(np.shape(NO.block[NO.nx/2,:,:]))
      4 failed = np.zeros(n)
      5


AttributeError: &#39;list&#39; object has no attribute &#39;block&#39;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">imshow</span><span class="p">(</span><span class="n">intersections_grid</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
       <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gray_r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x1176af7d0&gt;
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_27_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_27_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">all_outputs_2</span> <span class="o">=</span> <span class="n">all_outputs</span><span class="p">[:]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">all_outputs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_29_0.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_29_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># overlay probability on one output</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">all_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">intersections_grid</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
       <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x108660a50&gt;
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_30_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_30_1.png" />
</div>
<div class="section" id="analysis-of-statistics">
<h2>Analysis of statistics<a class="headerlink" href="#analysis-of-statistics" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">hist</span><span class="p">(</span><span class="n">all_fault_states</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>(array([ 43.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,  57.]),
 array([ 0. ,  0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9,  1. ]),
 &lt;a list of 10 Patch objects&gt;)
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_32_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_32_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre>?? bar
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">H1</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">)</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">,</span> <span class="n">tmp_out</span><span class="p">)</span>
<span class="n">NO_normal</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
<span class="n">H1</span><span class="o">.</span><span class="n">swap_events</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">H1</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">)</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">tmp_in</span><span class="p">,</span> <span class="n">tmp_out</span><span class="p">)</span>
<span class="n">NO_swap</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">NO_normal</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>
<span class="n">NO_swap</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;swap&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_35_0.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_35_0.png" />
<img alt="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_35_1.png" src="Marks%20Fault%20Uncertainty%20Study_files/Marks%20Fault%20Uncertainty%20Study_35_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">find_intersections</span><span class="p">(</span><span class="n">NO_swap</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">((</span><span class="mi">43</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">33</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">sum</span><span class="p">(</span><span class="n">failed</span> <span class="o">*</span> <span class="n">all_fault_states</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">27.0</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Marks Fault Uncertainty Study</a><ul>
<li><a class="reference internal" href="#evaluating-the-effect-of-uncertainties-in-fault-dip">Evaluating the effect of uncertainties in fault dip</a></li>
<li><a class="reference internal" href="#considering-uncertainties-in-the-history">Considering uncertainties in the history</a></li>
<li><a class="reference internal" href="#analysis-of-statistics">Analysis of statistics</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Marks Fault Uncertainty Study.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Florian Wellmann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>